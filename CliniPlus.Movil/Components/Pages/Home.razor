@page "/home"
@layout CliniPlus.Movil.Components.Layout.EmptyLayout
@inject CliniPlus.Movil.Services.Contrato.IAuthService Auth
@inject NavigationManager Nav

@if (_cargando)
{
    <div class="home-loading text-center mt-5">
        <div class="spinner-border spinner-border-sm me-2"></div>
        <span>Cargando tu información...</span>
    </div>
}

@code {
    private bool _cargando = true;

    protected override async Task OnInitializedAsync()
    {
        var me = await Auth.MeAsync();

        if (me is null)
        {
            Nav.NavigateTo("/", true);
            return;
        }

        // Redirección según rol
        switch (me.Rol)
        {
            case "Administrador":
                Nav.NavigateTo("/admin/home", true);
                break;

            case "Medico":
                Nav.NavigateTo("/medico/home", true);
                break;

            case "Secretario":
            case "Secretaria":
                Nav.NavigateTo("/secretaria/home", true);
                break;

            case "Paciente":
            default:
                Nav.NavigateTo("/paciente/home", true);
                break;
        }

        _cargando = false;
    }
}
